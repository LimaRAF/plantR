<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate Squared Mahalanobis Distances — mahalanobisDist • plantR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate Squared Mahalanobis Distances — mahalanobisDist" />
<meta property="og:description" content="Calculate Squared Mahalanobis Distances" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">plantR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/plantr_introduction.html">An Introduction to __plantR__</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/LimaRAF/plantR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate Squared Mahalanobis Distances</h1>
    <small class="dont-index">Source: <a href='https://github.com/LimaRAF/plantR/blob/master/R/accessory_geo.R'><code>R/accessory_geo.R</code></a></small>
    <div class="hidden name"><code>mahalanobisDist.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculate Squared Mahalanobis Distances</p>
    </div>

    <pre class="usage"><span class='fu'>mahalanobisDist</span><span class='op'>(</span>
  <span class='va'>lon</span>,
  <span class='va'>lat</span>,
  method <span class='op'>=</span> <span class='cn'>NULL</span>,
  n.min <span class='op'>=</span> <span class='fl'>5</span>,
  digs <span class='op'>=</span> <span class='fl'>4</span>,
  center <span class='op'>=</span> <span class='st'>"mean"</span>,
  geo <span class='op'>=</span> <span class='cn'>NULL</span>,
  cult <span class='op'>=</span> <span class='cn'>NULL</span>,
  geo.patt <span class='op'>=</span> <span class='st'>"ok_"</span>,
  cult.patt <span class='op'>=</span> <span class='cn'>NA</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>lon</th>
      <td><p>numerical. Longitude in decimal degrees</p></td>
    </tr>
    <tr>
      <th>lat</th>
      <td><p>numerical. Latitude in decimal degrees</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>character. Type of method desired: 'classic' and/or 'robust'
(see Details)</p></td>
    </tr>
    <tr>
      <th>n.min</th>
      <td><p>numerical. Minimum number of unique coordinates to be used in
the calculations.</p></td>
    </tr>
    <tr>
      <th>digs</th>
      <td><p>numerical. Number of digits to be returned after the decimal
point. Default to 4</p></td>
    </tr>
    <tr>
      <th>center</th>
      <td><p>character. Which metric should be used to obtain he center of
the distribution of coordinates: 'mean' or 'median'?</p></td>
    </tr>
    <tr>
      <th>geo</th>
      <td><p>character. A vector of the same length of lon/lat containing the
result from the validation of the geographical coordinates. Default to NULL.</p></td>
    </tr>
    <tr>
      <th>cult</th>
      <td><p>character. A vector of the same length of lon/lat containing the
result from the validation of cultivated specimens. Default to NULL.</p></td>
    </tr>
    <tr>
      <th>geo.patt</th>
      <td><p>character. The pattern to be used to search for classes of
geographical validation to be included in the analyses. Default to "ok_".</p></td>
    </tr>
    <tr>
      <th>cult.patt</th>
      <td><p>character. The pattern to be used to search for classes of
validation of cultivated specimens to be included in the analyses. Default
to NA.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>the input data frame and a new column(s) with the distances obtained
using the selected method(s)</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Two possible methods to calculate the Mahalanobis distances are
available: the classic (<code>method</code>= 'classic') and the robust methods
(<code>method</code>= 'robust'). The two methods take into account the geographical
center of the coordinates distribution and the spatial covariance between
them. But they vary in the way the covariance matrix of the distribution is
defined: the classic method uses an approach based on Pearson’s method,
while the robust method uses a Minimum Covariance Determinant (MCD)
estimator.</p>
<p>The argument <code>n.min</code> controls the minimum number of unique coordinates
necessary to calculate the distances. The classic and robust methods needs
at least 3 and 4 spatially unique coordinates to obtain the distances. But
the MCD algorithm of the robust method can run into singularity issues
depending on how close the coordinates are. This issue can result in
the overestimation of the distances and thus in bad outlier flagging. A
minimum of five and ideally 10 unique coordinates should avoid those
problems.</p>
<p>If the MCD algorithm runs into singularity issues, the function silently
add some random noise to both coordinates and re-run the MCD algorithm.
This aims to deals with cases of few coordinates close to each other and in
practice should not change the overall result of the detection of spatial
outliers.</p>
<p>The presence of problematic coordinates and cultivated specimens can
greatly influence the estimation of the geographical center of the
coordinates distribution and the spatial covariance between them. Thus,
arguments <code>geo</code> and <code>cult</code> can be used to flag and remove those cases from
the computation of the center and covariance matrix. In both cases, the
user can provide the output from <strong>plantR</strong> functions <code><a href='checkCoord.html'>checkCoord()</a></code> and
<code><a href='getCult.html'>getCult()</a></code> or a logical TRUE/FALSE vector. By default, if the input are
the outputs from functions <code><a href='checkCoord.html'>checkCoord()</a></code> and <code><a href='getCult.html'>getCult()</a></code>, only the
coordinates flagged as 'ok_...' in <code>geo</code> and those not flagged in <code>cult</code>
(i.e. NAs) will be used. But users can select different search patterns
using the arguments <code>geo.patt</code> and <code>cult.patt</code>. For both input options, the
vector must have the same length of the coordinates provided in the
arguments <code>lat</code> and <code>lon</code>. By default, arguments <code>geo</code> and <code>cult</code> are set
to NULL, meaning that all coordinates will be used.</p>
<p>The function internally removes spatially duplicated coordinates previous
to the calculation of the Mahalanobis distances. So, the value in <code>n.min</code>
correspond to the number of coordinates after the removal of spatially
duplicated coordinates.</p>
<p>The function also internally removes any empty or NA values in <code>lon</code> or
<code>lat</code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='uniqueCoord.html'>uniqueCoord</a>, <a href='checkCoord.html'>checkCoord</a>,
<a href='getCult.html'>getCult</a></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Renato A. Ferreira de Lima</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>lon</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>42.2</span>,<span class='op'>-</span><span class='fl'>42.6</span>,<span class='op'>-</span><span class='fl'>45.3</span>,<span class='op'>-</span><span class='fl'>42.5</span>,<span class='op'>-</span><span class='fl'>42.3</span>,<span class='op'>-</span><span class='fl'>39.0</span>,<span class='op'>-</span><span class='fl'>12.2</span><span class='op'>)</span>
<span class='va'>lat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>44.6</span>,<span class='op'>-</span><span class='fl'>46.2</span>,<span class='op'>-</span><span class='fl'>45.4</span>,<span class='op'>-</span><span class='fl'>42.2</span>,<span class='op'>-</span><span class='fl'>43.7</span>,<span class='op'>-</span><span class='fl'>45.0</span>,<span class='op'>-</span><span class='fl'>8.0</span><span class='op'>)</span>

<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># Assuming that all coordinates are valid</span>
<span class='fu'>mahalanobisDist</span><span class='op'>(</span><span class='va'>lon</span>, <span class='va'>lat</span>, method <span class='op'>=</span> <span class='st'>"classic"</span>, n.min <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'>mahalanobisDist</span><span class='op'>(</span><span class='va'>lon</span>, <span class='va'>lat</span>, method <span class='op'>=</span> <span class='st'>"robust"</span>, n.min <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='co'># Flagging last coordinate as problematic</span>
<span class='fu'>mahalanobisDist</span><span class='op'>(</span><span class='va'>lon</span>, <span class='va'>lat</span>, method <span class='op'>=</span> <span class='st'>"classic"</span>, n.min <span class='op'>=</span> <span class='fl'>1</span>,
geo <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>TRUE</span>, <span class='fl'>6</span><span class='op'>)</span>, <span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>mahalanobisDist</span><span class='op'>(</span><span class='va'>lon</span>, <span class='va'>lat</span>, method <span class='op'>=</span> <span class='st'>"robust"</span>, n.min <span class='op'>=</span> <span class='fl'>1</span>,
geo <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>TRUE</span>, <span class='fl'>6</span><span class='op'>)</span>, <span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Renato A. Ferreira de Lima, Sara R. Mortara, Andrea Sánchez-Tapia.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


